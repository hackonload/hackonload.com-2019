#!/usr/bin/env node

const mailer = require("./../mail/mailer");
const participants = require("./../data/participants");

String.prototype.firstWord = function () {
	return this.replace(/\s.*/, '')
};

const logARR = [];
let count = 0;

const callback = (err, info) => {
	if (err) {
		console.log(err);
	} else {
		console.log(info.envelope);
		console.log(info.messageId);
	}
};

for (let i = 0; i < participants.length; i++) {
	let participant = participants[i];

	let email = participant.email;
	let name = participant.name;
	name = name.firstWord();

	count++;
	mailer.sendIndorseEmail(name, email).then((info) => {
		console.log(info);
	}).catch((err) => {
		console.log("Error in sending mail to " + email);
		console.log(err);
		mailer.htmlMail("anandpushkar088@gmail.com", "Error in mail", err.toString(), callback);
	});

	logARR.push(participant);
}
console.log("Mail Count: " + count);
mailer.htmlMail("anandpushkar088@gmail.com", "Indorse Mail Data", JSON.stringify(logARR), callback);