#!/usr/bin/env node

const mailer = require("./../mail/mailer");
const participants = require("./../data/participants");

const logARR = [];

const callback = (err, info) => {
	if(err) {
		console.log(err);
	} else {
		console.log(info.envelope);
		console.log(info.messageId);
	}
};

for (let i = 0; i < participants.length; i++) {
	let participant = participants[i];

	let name = participant.name;
	let email = participant.email;
	let slack_invite_sent = participant.slack_invite_sent;

	if (!slack_invite_sent) {
		mailer.sendSlackInviteEmail(name, email).then((info) => {
			console.log(info);
			participant.slack_invite_sent = true;
		}).catch((err) => {
			console.log(err);
			//TODO send err mail
			mailer.textMail("anandpushkar088@gmail.com", "Error in mail", err, callback);
		});
		logARR.push(participant);
	} else {
		logARR.push(participant);
	}
	mailer.textMail("anandpushkar088@gmail.com", "Error in mail", logARR.toString(), callback);
}